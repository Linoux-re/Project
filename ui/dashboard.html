<!DOCTYPE html>
<html lang="fr" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dashboard – Pronote UI</title>
    <link rel="stylesheet" href="assets/css/base.css" />
    <link rel="stylesheet" href="assets/css/layout.css" />
    <link rel="stylesheet" href="assets/css/components.css" />
    <link rel="stylesheet" href="assets/css/forms.css" />
    <link rel="stylesheet" href="assets/css/animations.css" />
  </head>
  <body>
    <div class="app-drawer-backdrop" aria-hidden="true"></div>
    <aside class="app-sidebar" aria-label="Navigation principale">
      <div class="app-sidebar__header">
        <span class="login-brand"><strong>Pronote UI</strong></span>
        <button class="btn btn--icon" data-sidebar-toggle aria-label="Fermer la navigation">
          <svg aria-hidden="true"><use href="assets/icons/ui-sprite.svg#icon-close"></use></svg>
        </button>
      </div>
      <nav class="app-sidebar__nav">
        <div class="nav-section">
          <p class="nav-section__title">Espace</p>
          <a class="nav-link" href="dashboard.html" aria-current="page">
            <svg aria-hidden="true"><use href="assets/icons/ui-sprite.svg#icon-dashboard"></use></svg>
            Tableau de bord
          </a>
          <a class="nav-link" href="edt.html">
            <svg aria-hidden="true"><use href="assets/icons/ui-sprite.svg#icon-calendar"></use></svg>
            Emploi du temps
          </a>
          <a class="nav-link" href="devoirs.html">
            <svg aria-hidden="true"><use href="assets/icons/ui-sprite.svg#icon-tasks"></use></svg>
            Cahier de texte
          </a>
          <a class="nav-link" href="notes.html">
            <svg aria-hidden="true"><use href="assets/icons/ui-sprite.svg#icon-grade"></use></svg>
            Notes
          </a>
          <a class="nav-link" href="absences.html">
            <svg aria-hidden="true"><use href="assets/icons/ui-sprite.svg#icon-absent"></use></svg>
            Absences
          </a>
          <a class="nav-link" href="messages.html">
            <svg aria-hidden="true"><use href="assets/icons/ui-sprite.svg#icon-mail"></use></svg>
            Messagerie
          </a>
          <a class="nav-link" href="documents.html">
            <svg aria-hidden="true"><use href="assets/icons/ui-sprite.svg#icon-file"></use></svg>
            Documents
          </a>
        </div>
      </nav>
      <footer class="app-footer">© 2024 Collège Horizon</footer>
    </aside>

    <header class="app-topbar">
      <div class="app-topbar__left">
        <button class="btn btn--icon" data-sidebar-toggle aria-label="Ouvrir la navigation">
          <svg aria-hidden="true"><use href="assets/icons/ui-sprite.svg#icon-menu"></use></svg>
        </button>
        <div class="app-topbar__search">
          <svg aria-hidden="true"><use href="assets/icons/ui-sprite.svg#icon-search"></use></svg>
          <input class="input" type="search" placeholder="Rechercher…" aria-label="Rechercher" />
        </div>
      </div>
      <div class="app-topbar__right">
        <button class="btn btn--ghost" data-theme-toggle aria-pressed="false" type="button" aria-label="Basculer le thème">
          <svg aria-hidden="true"><use href="assets/icons/ui-sprite.svg#icon-moon"></use></svg>
        </button>
        <button class="btn btn--icon" type="button" data-toast="Aucune nouvelle notification" aria-label="Notifications">
          <svg aria-hidden="true"><use href="assets/icons/ui-sprite.svg#icon-bell"></use></svg>
          <span class="badge badge--danger" aria-hidden="true" id="notif-count">0</span>
        </button>
        <div class="dropdown" data-dropdown>
          <button class="btn btn--ghost" type="button" aria-haspopup="true" aria-expanded="false">
            <span class="avatar" aria-hidden="true">LM</span>
            <span id="user-name">Utilisateur·rice</span>
          </button>
          <div class="dropdown__menu" role="menu">
            <button class="dropdown__item" role="menuitem" data-modal-open="modal-shortcuts">Raccourcis clavier</button>
            <a class="dropdown__item" href="login.html">Se déconnecter</a>
          </div>
        </div>
      </div>
    </header>

    <main class="app-main" id="main">
      <div class="app-content">
        <section class="role-banner" id="role-banner">
          <div>
            <p class="badge">Bienvenue</p>
            <strong id="role-title">Espace élève</strong>
            <p class="text-muted" id="role-description">Suivez vos cours, devoirs et messages.</p>
          </div>
          <div class="stat-pair">
            <span>Notifications</span>
            <strong id="stat-notifs">0</strong>
          </div>
        </section>

        <section class="cards-grid">
          <article class="card card--span-6" id="card-cours">
            <header class="card__header">
              <h2 class="card__title">Prochains cours</h2>
            </header>
            <div class="widget-list" id="widget-cours"></div>
          </article>
          <article class="card card--span-6" id="card-devoirs">
            <header class="card__header">
              <h2 class="card__title">Devoirs à faire</h2>
            </header>
            <div class="widget-list" id="widget-devoirs"></div>
          </article>
          <article class="card card--span-4" id="card-notes">
            <header class="card__header">
              <h2 class="card__title">Dernières notes</h2>
            </header>
            <div class="widget-list" id="widget-notes"></div>
          </article>
          <article class="card card--span-4" id="card-actualites">
            <header class="card__header">
              <h2 class="card__title">Notifications</h2>
            </header>
            <div class="widget-list" id="widget-notifications"></div>
          </article>
          <article class="card card--span-4" id="card-accessibilite">
            <header class="card__header">
              <h2 class="card__title">Accessibilité</h2>
            </header>
            <p>Activez/désactivez les animations pour réduire la fatigue visuelle.</p>
            <button class="btn btn--secondary" type="button" data-motion-toggle>Désactiver les animations</button>
          </article>
        </section>
      </div>
    </main>

    <div class="modal" id="modal-shortcuts" role="dialog" aria-modal="true" aria-labelledby="modal-shortcuts-title" data-open="false">
      <div class="modal__overlay" data-modal-close="modal-shortcuts"></div>
      <div class="modal__content">
        <header class="modal__header">
          <h2 id="modal-shortcuts-title">Raccourcis clavier</h2>
          <button class="btn btn--ghost" type="button" data-modal-close="modal-shortcuts" aria-label="Fermer">&times;</button>
        </header>
        <ul>
          <li><kbd>g</kbd> + <kbd>d</kbd> : Dashboard</li>
          <li><kbd>g</kbd> + <kbd>e</kbd> : Emploi du temps</li>
          <li><kbd>?</kbd> : Ouvrir cette aide</li>
        </ul>
      </div>
    </div>

    <script type="module" src="assets/js/app.js"></script>
    <script type="module">
      import { initShell } from "./assets/js/app.js";
      import { loadJSON, formatDate } from "./assets/js/util.js";
      initShell();
      const roleMap = {
        eleve: { title: "Espace élève", desc: "Suivez vos cours, devoirs et messages." },
        parent: { title: "Espace parent", desc: "Suivez les apprentissages et justifiez les absences." },
        prof: { title: "Espace professeur", desc: "Planifiez vos cours et communiquez avec les classes." }
      };
      const params = new URLSearchParams(window.location.search);
      const roleParam = params.get("role") || "eleve";
      const role = roleMap[roleParam] || roleMap.eleve;
      document.getElementById("role-title").textContent = role.title;
      document.getElementById("role-description").textContent = role.desc;
      Promise.all([loadJSON("./mock/me.json"), loadJSON("./mock/dashboard.json")]).then(([me, dashboard]) => {
        document.getElementById("user-name").textContent = me.name;
        document.getElementById("stat-notifs").textContent = me.notifications;
        document.getElementById("notif-count").textContent = me.notifications;
        const cours = dashboard.widgets.prochainsCours
          .map((item) => `<div class="widget-list__item"><span>${item.title}</span><span class="text-muted">${item.time} · ${item.room}</span></div>`)
          .join("");
        document.getElementById("widget-cours").innerHTML = cours;
        document.getElementById("widget-devoirs").innerHTML = dashboard.widgets.devoirsAfaire
          .map((item) => `<div class="widget-list__item"><span>${item.title}</span><span class="text-muted">${formatDate(item.due)}</span></div>`)
          .join("");
        document.getElementById("widget-notes").innerHTML = dashboard.widgets.dernieresNotes
          .map((item) => `<div class="widget-list__item"><span>${item.subject}</span><span class="text-muted">${item.value}/${item.scale}</span></div>`)
          .join("");
        document.getElementById("widget-notifications").innerHTML = dashboard.widgets.notifications
          .map((item) => `<div class="widget-list__item"><span>${item.message}</span></div>`)
          .join("");
      });
    </script>
  </body>
</html>

<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Absences et retards – Pronote UI</title>
    <link rel="stylesheet" href="assets/css/base.css" />
    <link rel="stylesheet" href="assets/css/layout.css" />
    <link rel="stylesheet" href="assets/css/components.css" />
    <link rel="stylesheet" href="assets/css/forms.css" />
    <link rel="stylesheet" href="assets/css/animations.css" />
  </head>
  <body>
    <div class="app-drawer-backdrop" aria-hidden="true"></div>
    <aside class="app-sidebar" aria-label="Navigation principale">
      <div class="app-sidebar__header">
        <span class="login-brand"><strong>Pronote UI</strong></span>
        <button class="btn btn--icon" data-sidebar-toggle aria-label="Fermer la navigation">
          <svg aria-hidden="true"><use href="assets/icons/ui-sprite.svg#icon-close"></use></svg>
        </button>
      </div>
      <nav class="app-sidebar__nav">
        <div class="nav-section">
          <p class="nav-section__title">Espace</p>
          <a class="nav-link" href="dashboard.html">
          <svg aria-hidden="true"><use href="assets/icons/ui-sprite.svg#icon-dashboard"></use></svg>
            Tableau de bord
          </a>
          <a class="nav-link" href="edt.html">
          <svg aria-hidden="true"><use href="assets/icons/ui-sprite.svg#icon-calendar"></use></svg>
            Emploi du temps
          </a>
          <a class="nav-link" href="devoirs.html">
          <svg aria-hidden="true"><use href="assets/icons/ui-sprite.svg#icon-tasks"></use></svg>
            Cahier de texte
          </a>
          <a class="nav-link" href="notes.html">
          <svg aria-hidden="true"><use href="assets/icons/ui-sprite.svg#icon-grade"></use></svg>
            Notes
          </a>
          <a class="nav-link" href="absences.html" aria-current="page">
          <svg aria-hidden="true"><use href="assets/icons/ui-sprite.svg#icon-absent"></use></svg>
            Absences
          </a>
          <a class="nav-link" href="messages.html">
          <svg aria-hidden="true"><use href="assets/icons/ui-sprite.svg#icon-mail"></use></svg>
            Messagerie
          </a>
          <a class="nav-link" href="documents.html">
          <svg aria-hidden="true"><use href="assets/icons/ui-sprite.svg#icon-file"></use></svg>
            Documents
          </a>
        </div>
      </nav>
      <footer class="app-footer">© 2024 Collège Horizon</footer>
    </aside>

    <header class="app-topbar">
      <div class="app-topbar__left">
        <button class="btn btn--icon" data-sidebar-toggle aria-label="Ouvrir la navigation">
          <svg aria-hidden="true"><use href="assets/icons/ui-sprite.svg#icon-menu"></use></svg>
        </button>
        <h1 class="card__title">Absences et retards</h1>
      </div>
      <div class="app-topbar__right">
        <button class="btn btn--ghost" data-theme-toggle type="button" aria-label="Changer de thème">
          <span data-theme-label>Thème : Océan</span>
          <svg aria-hidden="true"><use href="assets/icons/ui-sprite.svg#icon-moon"></use></svg>
        </button>
      </div>
    </header>

    <main class="app-main" id="main">
      <div class="app-content">
        <section class="card">
          <header class="card__header">
            <h2 class="card__title">Historique</h2>
          </header>
          <div class="table-wrapper" data-collapse="true">
            <table>
              <thead>
                <tr>
                  <th scope="col">Date</th>
                  <th scope="col">Type</th>
                  <th scope="col">Motif</th>
                  <th scope="col">Durée</th>
                  <th scope="col">Statut</th>
                  <th scope="col">Action</th>
                </tr>
              </thead>
              <tbody id="absences-body"></tbody>
            </table>
          </div>
        </section>
      </div>
    </main>

    <script type="module" src="assets/js/app.js"></script>
    <script type="module">
      import { initShell } from "./assets/js/app.js";
      import { loadJSON, formatDate, toast } from "./assets/js/util.js";
      initShell();
      const body = document.getElementById("absences-body");
      let absences = [];
      const render = () => {
        body.innerHTML = absences
          .map((item, index) => `
            <tr>
              <td>${formatDate(item.date)}</td>
              <td>${item.type}</td>
              <td>${item.motif}</td>
              <td>${item.hours}h</td>
              <td>${item.justified ? '<span class="badge badge--ok">Justifié</span>' : '<span class="badge badge--danger">Non justifié</span>'}</td>
              <td>
                <button class="btn btn--secondary" type="button" data-index="${index}" ${item.justified ? 'disabled' : ''}>Justifier</button>
              </td>
            </tr>
          `)
          .join("");
      };
      loadJSON("./mock/absences.json").then((data) => {
        absences = data;
        render();
      });
      body?.addEventListener("click", (event) => {
        const button = event.target.closest("button[data-index]");
        if (!button) return;
        const index = Number(button.dataset.index);
        absences[index].justified = true;
        toast("Justificatif envoyé (démo)", "success");
        render();
      });
    </script>
  </body>
</html>
